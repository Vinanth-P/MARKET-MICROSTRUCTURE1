{% extends 'base.html' %}
{% load static %}

{% block title %}Price Forecast - Predictr{% endblock %}

{% block content %}
<div class="forecast-container">
    <div class="forecast-sidebar">
        <h2>Configuration</h2>
        
        <form method="post" action="{% url 'forecast:run_forecast' %}" id="forecast-form">
            {% csrf_token %}
            
            <div class="form-section">
                <label>Select Asset</label>
                <select name="asset" class="form-select" required>
                    <option value="">Choose asset...</option>
                    {% for asset in assets %}
                    <option value="{{ asset.symbol }}">{{ asset.name }} ({{ asset.symbol }})</option>
                    {% endfor %}
                </select>
                <div class="recent-assets">
                    <span>Recent:</span>
                    <button type="button" class="asset-btn" data-symbol="SOL/USD">SOL</button>
                    <button type="button" class="asset-btn" data-symbol="TSLA">TSLA</button>
                </div>
            </div>
            
            <div class="form-section">
                <label>Prediction Horizon</label>
                <input type="range" name="horizon" min="1" max="30" value="7" class="slider" id="horizon-slider">
                <div class="slider-value">
                    <span id="horizon-value">7 Days</span>
                </div>
            </div>
            
            <div class="form-section">
                <label>Risk Tolerance</label>
                <input type="range" name="risk" min="0" max="2" value="1" class="slider" id="risk-slider">
                <div class="slider-value">
                    <span id="risk-value">Medium</span>
                </div>
            </div>
            
            <div class="form-section">
                <label>Indicators</label>
                <div class="toggle-group">
                    <label class="toggle">
                        <input type="checkbox" name="rsi_divergence" checked>
                        <span class="toggle-label">RSI Divergence</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" name="macd_crossover">
                        <span class="toggle-label">MACD Crossover</span>
                    </label>
                    <label class="toggle">
                        <input type="checkbox" name="sentiment_analysis" checked>
                        <span class="toggle-label">Sentiment Analysis</span>
                    </label>
                </div>
            </div>
            
            <button type="submit" class="btn btn-primary btn-block">
                <span>‚ö°</span> Run Prediction
            </button>
            <button type="button" class="btn btn-secondary btn-block">Reset Parameters</button>
        </form>
    </div>
    
    <div class="forecast-main">
        <div class="page-header">
            <div>
                <h1>Bitcoin (BTC) Price Forecast</h1>
                <p>Model V4.2 ‚Ä¢ Updated 2 mins ago</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary">Share</button>
                <button class="btn btn-secondary">Export Report</button>
            </div>
        </div>
        
        <div class="forecast-cards">
            <div class="forecast-card">
                <div class="card-label">Current Price</div>
                <div class="card-value">$45,230.50</div>
                <div class="card-change positive">+2.4% (24h)</div>
            </div>
            <div class="forecast-card">
                <div class="card-label">Predicted High (7d)</div>
                <div class="card-value">$48,100.00</div>
                <div class="card-change positive">‚Üë+6.3% upside</div>
            </div>
            <div class="forecast-card">
                <div class="card-label">Predicted Low (7d)</div>
                <div class="card-value">$44,800.00</div>
                <div class="card-change negative">‚Üì-0.9% downside</div>
            </div>
            <div class="forecast-card">
                <div class="card-label">Confidence Score</div>
                <div class="card-value">87%</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 87%"></div>
                </div>
            </div>
        </div>
        
        <div class="forecast-chart-section">
            <div class="chart-header">
                <h3>Price Forecast vs Historical Data</h3>
                <div class="timeframe-selector">
                    <button class="timeframe-btn">1D</button>
                    <button class="timeframe-btn">1W</button>
                    <button class="timeframe-btn active">1M</button>
                    <button class="timeframe-btn">3M</button>
                    <button class="timeframe-btn">1Y</button>
                </div>
            </div>
            <div class="chart-legend">
                <span class="legend-item"><span class="legend-dot historical"></span> Historical</span>
                <span class="legend-item"><span class="legend-dot predicted"></span> Predicted</span>
                <span class="legend-item"><span class="legend-dot confidence"></span> Confidence Interval</span>
            </div>
            <div class="chart-container-large">
                <canvas id="forecastChart"></canvas>
            </div>
        </div>
        
        <div class="forecast-info-grid">
            <div class="info-card">
                <h3>AI Market Summary</h3>
                <p class="info-subtitle">Based on technical & sentiment analysis</p>
                <p class="info-text">
                    Our models indicate a strong <strong>Bullish</strong> trend continuation for Bitcoin over the next 7 days. 
                    The confluence of increasing volume and a positive RSI divergence suggests a potential breakout above 
                    the $47k resistance level. Sentiment analysis on social channels remains elevated.
                </p>
                <p class="info-meta">Processing time: 1.2s <a href="#">View detailed logs</a></p>
            </div>
            
            <div class="info-card">
                <h3>PATTERNS DETECTED</h3>
                <div class="pattern-list">
                    <div class="pattern-item-detected">
                        <span class="pattern-icon">üö©</span>
                        <div class="pattern-details">
                            <div class="pattern-name">Bullish Flag</div>
                            <div class="pattern-timeframe">4H Timeframe</div>
                        </div>
                        <div class="pattern-match">92% Match</div>
                    </div>
                    <div class="pattern-item-detected">
                        <span class="pattern-icon">‚ÜóÔ∏è</span>
                        <div class="pattern-details">
                            <div class="pattern-name">Golden Cross</div>
                            <div class="pattern-timeframe">Daily Moving Average</div>
                        </div>
                        <div class="pattern-match">78% Match</div>
                    </div>
                    <div class="pattern-item-detected">
                        <span class="pattern-icon">üíß</span>
                        <div class="pattern-details">
                            <div class="pattern-name">Volume Drop</div>
                            <div class="pattern-timeframe">Weakening momentum</div>
                        </div>
                        <div class="pattern-match">45% Match</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Slider updates
    const horizonSlider = document.getElementById('horizon-slider');
    const horizonValue = document.getElementById('horizon-value');
    horizonSlider.addEventListener('input', (e) => {
        horizonValue.textContent = e.target.value + ' Days';
    });
    
    const riskSlider = document.getElementById('risk-slider');
    const riskValue = document.getElementById('risk-value');
    const riskLabels = ['Low', 'Medium', 'High'];
    riskSlider.addEventListener('input', (e) => {
        riskValue.textContent = riskLabels[e.target.value];
    });
    
    // Asset button clicks
    document.querySelectorAll('.asset-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelector('select[name="asset"]').value = btn.dataset.symbol;
        });
    });
    
    // Forecast Chart
    const forecastCtx = document.getElementById('forecastChart');
    if (forecastCtx) {
        new Chart(forecastCtx, {
            type: 'line',
            data: {
                labels: ['Jan 01', 'Jan 05', 'Jan 10', 'Jan 15', 'Jan 20', 'Jan 25', 'Jan 30', 'Feb 05'],
                datasets: [{
                    label: 'Historical',
                    data: [45000, 45200, 45400, 45600, 45800, null, null, null],
                    borderColor: '#9ca3af',
                    borderDash: [],
                    tension: 0.4
                }, {
                    label: 'Predicted',
                    data: [null, null, null, null, 45800, 46200, 46500, 47000],
                    borderColor: '#3b82f6',
                    borderDash: [5, 5],
                    tension: 0.4
                }, {
                    label: 'Confidence Interval',
                    data: [null, null, null, null, 45800, 46200, 46500, 47000],
                    borderColor: 'rgba(59, 130, 246, 0.2)',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#9ca3af' }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { color: '#9ca3af' }
                    }
                }
            }
        });
    }
</script>
{% endblock %}


