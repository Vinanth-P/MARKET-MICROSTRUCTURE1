{% extends 'base.html' %}
{% load static %}
 
{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/forecast.css' %}">
{% endblock %}

{% block title %}Forecast Results - Predictr{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1>{{ forecast.asset.name }} Price Forecast</h1>
        <p>Model V4.2 â€¢ Updated {{ forecast.updated_at|timesince }} ago</p>
    </div>
    <div class="header-actions">
        <button class="btn btn-secondary">Share</button>
        <button class="btn btn-secondary">Export Report</button>
    </div>
</div>

<div class="forecast-cards">
    <div class="forecast-card">
        <div class="card-label">Current Price</div>
        <div class="card-value">${{ forecast.current_price|floatformat:2 }}</div>
        <div class="card-change positive">+2.4% (24h)</div>
    </div>
    <div class="forecast-card">
        <div class="card-label">Predicted High ({{ forecast.prediction_horizon_days }}d)</div>
        <div class="card-value">${{ forecast.predicted_high|floatformat:2 }}</div>
    </div>
    <div class="forecast-card">
        <div class="card-label">Predicted Low ({{ forecast.prediction_horizon_days }}d)</div>
        <div class="card-value">${{ forecast.predicted_low|floatformat:2 }}</div>
    </div>
    <div class="forecast-card">
        <div class="card-label">Confidence Score</div>
        <div class="card-value">{{ forecast.confidence_score }}%</div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ forecast.confidence_score }}%"></div>
        </div>
    </div>
</div>

<div class="forecast-chart-section">
    <div class="chart-header">
        <h3>Price Forecast vs Historical Data</h3>
        <div class="timeframe-selector">
            <button class="timeframe-btn">1D</button>
            <button class="timeframe-btn">1W</button>
            <button class="timeframe-btn active">1M</button>
        </div>
    </div>
    <div class="chart-controls">
        <label>Symbol: <input id="bt_symbol" type="text" value="BTCUSDT"></label>
        <label>Interval: <select id="bt_interval"><option value="1d">1d</option><option value="4h">4h</option><option value="1h">1h</option></select></label>
        <label>Short MA: <input id="bt_short" type="number" value="10" min="1"></label>
        <label>Long MA: <input id="bt_long" type="number" value="50" min="1"></label>
        <label>Forecast Days: <input id="bt_forecast_days" type="number" value="5" min="1"></label>
        <label>Initial Capital: <input id="bt_capital" type="number" value="10000" min="0"></label>
        <label>Save Run: <input id="bt_save" type="checkbox"></label>
        <button id="bt_run" class="btn btn-primary">Run Backtest</button>
    </div>
    <div class="chart-container-large">
        <div id="pricePlot" style="width:100%;height:420px;"></div>
        <div id="equityPlot" style="width:100%;height:240px;margin-top:12px;"></div>
    </div>
</div>

{% if patterns %}
<div class="info-card">
    <h3>PATTERNS DETECTED</h3>
    <div class="pattern-list">
        {% for pattern in patterns %}
        <div class="pattern-item-detected">
            <span class="pattern-icon">ðŸ“Š</span>
            <div class="pattern-details">
                <div class="pattern-name">{{ pattern.get_pattern_type_display }}</div>
                <div class="pattern-timeframe">{{ pattern.timeframe }} Timeframe</div>
            </div>
            <div class="pattern-match">{{ pattern.match_percentage }}% Match</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}
{% block extra_js %}
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="{% static 'forecast/js/forecast.js' %}"></script>
{% endblock %}


