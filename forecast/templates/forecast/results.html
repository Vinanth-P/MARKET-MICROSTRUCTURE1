{% extends 'base.html' %}
{% load static %}

{% block title %}Forecast Results - Predictr{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1>{{ forecast.asset.name }} Price Forecast</h1>
        <p>Model V4.2 â€¢ Updated {{ forecast.updated_at|timesince }} ago</p>
    </div>
    <div class="header-actions">
        <button class="btn btn-secondary">Share</button>
        <button class="btn btn-secondary">Export Report</button>
    </div>
</div>

<div class="forecast-cards">
    <div class="forecast-card">
        <div class="card-label">Current Price</div>
        <div class="card-value">${{ forecast.current_price|floatformat:2 }}</div>
        <div class="card-change positive">+2.4% (24h)</div>
    </div>
    <div class="forecast-card">
        <div class="card-label">Predicted High ({{ forecast.prediction_horizon_days }}d)</div>
        <div class="card-value">${{ forecast.predicted_high|floatformat:2 }}</div>
        <div class="card-change positive">â†‘+{{ forecast.predicted_high|floatformat:2 }} upside</div>
    </div>
    <div class="forecast-card">
        <div class="card-label">Predicted Low ({{ forecast.prediction_horizon_days }}d)</div>
        <div class="card-value">${{ forecast.predicted_low|floatformat:2 }}</div>
        <div class="card-change negative">â†“-{{ forecast.predicted_low|floatformat:2 }} downside</div>
    </div>
    <div class="forecast-card">
        <div class="card-label">Confidence Score</div>
        <div class="card-value">{{ forecast.confidence_score }}%</div>
        <div class="progress-bar">
            <div class="progress-fill" style="width: {{ forecast.confidence_score }}%"></div>
        </div>
    </div>
</div>

<div class="forecast-chart-section">
    <div class="chart-header">
        <h3>Price Forecast vs Historical Data</h3>
        <div class="timeframe-selector">
            <button class="timeframe-btn">1D</button>
            <button class="timeframe-btn">1W</button>
            <button class="timeframe-btn active">1M</button>
        </div>
    </div>
    <div class="chart-container-large">
        <canvas id="forecastChart"></canvas>
    </div>
</div>

{% if patterns %}
<div class="info-card">
    <h3>PATTERNS DETECTED</h3>
    <div class="pattern-list">
        {% for pattern in patterns %}
        <div class="pattern-item-detected">
            <span class="pattern-icon">ðŸ“Š</span>
            <div class="pattern-details">
                <div class="pattern-name">{{ pattern.get_pattern_type_display }}</div>
                <div class="pattern-timeframe">{{ pattern.timeframe }} Timeframe</div>
            </div>
            <div class="pattern-match">{{ pattern.match_percentage }}% Match</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    const forecastCtx = document.getElementById('forecastChart');
    if (forecastCtx) {
        const forecastData = [
            {% for point in forecast_points %}
            {x: '{{ point.date|date:"M d" }}', y: {{ point.predicted_price }}},
            {% endfor %}
        ];
        
        new Chart(forecastCtx, {
            type: 'line',
            data: {
                datasets: [{
                    label: 'Predicted',
                    data: forecastData.length > 0 ? forecastData : [{x: 'Today', y: {{ forecast.current_price }}}],
                    borderColor: '#3b82f6',
                    borderDash: [5, 5],
                    tension: 0.4,
                    fill: true,
                    backgroundColor: 'rgba(59, 130, 246, 0.1)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: { color: 'rgba(255, 255, 255, 0.1)' },
                        ticks: { color: '#9ca3af' }
                    },
                    x: {
                        type: 'category',
                        grid: { display: false },
                        ticks: { color: '#9ca3af' }
                    }
                }
            }
        });
    }
</script>
{% endblock %}


